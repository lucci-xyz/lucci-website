export const metadata = { 
  title: 'Integration Guide â€” Lucci Labs',
  description: 'Learn how to integrate Lucci Labs products into your projects'
}

# Integration Guide

Learn how to integrate Lucci Labs products into your applications. This guide covers common integration patterns, best practices, and troubleshooting tips.

## Prerequisites

Before integrating Lucci Labs products:

- **Node.js 18+** for JavaScript/TypeScript projects
- **Web3 Provider** (Infura, Alchemy, or your own node)
- **Wallet Connection** for blockchain interactions
- **API Keys** for specific products (BountyPay)

## General Integration Pattern

All Lucci Labs products follow a similar integration pattern:

```typescript
// 1. Install the SDK
npm install @lucci/[product-name]

// 2. Initialize the client
import { Client } from '@lucci/product-name'

const client = new Client({
  apiKey: process.env.API_KEY,
  network: 'mainnet'
})

// 3. Use the client
const result = await client.doSomething()
```

## Integrating BountyPay

### React Integration

```typescript
import { BountyPayProvider, useBountyPay } from '@lucci/bountypay-react'

// Wrap your app with the provider
function App() {
  return (
    <BountyPayProvider apiKey={process.env.BOUNTYPAY_API_KEY}>
      <YourApp />
    </BountyPayProvider>
  )
}

// Use the hook in components
function BountyCreator() {
  const { createBounty, loading, error } = useBountyPay()
  
  const handleCreate = async () => {
    try {
      const bounty = await createBounty({
        repository: 'owner/repo',
        issueNumber: 123,
        amount: 100
      })
      console.log('Bounty created:', bounty.id)
    } catch (error) {
      console.error('Failed to create bounty:', error)
    }
  }
  
  return (
    <button onClick={handleCreate} disabled={loading}>
      {loading ? 'Creating...' : 'Create Bounty'}
    </button>
  )
}
```

### Node.js Backend Integration

```typescript
import express from 'express'
import { BountyPayClient } from '@lucci/bountypay'

const app = express()
const bountyPay = new BountyPayClient({
  apiKey: process.env.BOUNTYPAY_API_KEY
})

// Endpoint to create bounty
app.post('/api/bounties', async (req, res) => {
  try {
    const { repository, issueNumber, amount } = req.body
    
    // Validate input
    if (!repository || !issueNumber || !amount) {
      return res.status(400).json({ error: 'Missing required fields' })
    }
    
    // Create bounty
    const bounty = await bountyPay.createBounty({
      repository,
      issueNumber,
      amount
    })
    
    res.json({ success: true, bounty })
  } catch (error) {
    console.error('Bounty creation failed:', error)
    res.status(500).json({ error: error.message })
  }
})

// Webhook endpoint
app.post('/webhooks/bountypay', async (req, res) => {
  const signature = req.headers['x-bountypay-signature']
  
  // Verify webhook signature
  if (!bountyPay.verifyWebhook(req.body, signature)) {
    return res.status(401).json({ error: 'Invalid signature' })
  }
  
  const event = req.body
  
  switch (event.type) {
    case 'bounty.paid':
      // Handle payment success
      await handleBountyPaid(event.data)
      break
    case 'bounty.cancelled':
      // Handle cancellation
      await handleBountyCancelled(event.data)
      break
  }
  
  res.json({ received: true })
})

app.listen(3000)
```

### GitHub Actions Integration

Create automated bounties with GitHub Actions:

```yaml
# .github/workflows/bounty-on-label.yml
name: Create Bounty on Label

on:
  issues:
    types: [labeled]

jobs:
  create-bounty:
    if: contains(github.event.label.name, 'bounty')
    runs-on: ubuntu-latest
    steps:
      - name: Extract bounty amount
        id: amount
        run: |
          LABEL="${{ github.event.label.name }}"
          AMOUNT=$(echo $LABEL | grep -oP '(?<=bounty:)\d+')
          echo "amount=$AMOUNT" >> $GITHUB_OUTPUT
      
      - name: Create bounty
        run: |
          curl -X POST https://api.bountypay.xyz/v1/bounties \
            -H "Authorization: Bearer ${{ secrets.BOUNTYPAY_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{
              "repository": "${{ github.repository }}",
              "issue_number": ${{ github.event.issue.number }},
              "amount": ${{ steps.amount.outputs.amount }}
            }'
```

## Integrating Good First Issues

### Embedding in Your Website

```typescript
import { GoodFirstIssues } from '@lucci/good-first-issues-widget'

function CommunityPage() {
  return (
    <div>
      <h1>Contribute to Our Project</h1>
      <GoodFirstIssues
        repository="your-org/your-repo"
        maxIssues={5}
        theme="light"
      />
    </div>
  )
}
```

### Custom Integration

```typescript
// Fetch issues directly from the API
async function fetchGoodFirstIssues() {
  const response = await fetch(
    'https://api.goodfirstissues.dev/issues?repo=aave/aave-v3-core'
  )
  const data = await response.json()
  
  return data.issues.map(issue => ({
    title: issue.title,
    url: issue.url,
    labels: issue.labels,
    difficulty: issue.difficulty
  }))
}

// Display in your UI
function IssueList() {
  const [issues, setIssues] = useState([])
  
  useEffect(() => {
    fetchGoodFirstIssues().then(setIssues)
  }, [])
  
  return (
    <div className="issue-list">
      {issues.map(issue => (
        <IssueCard key={issue.url} issue={issue} />
      ))}
    </div>
  )
}
```

## Smart Contract Integration

### Calling Lucci Contracts

```typescript
import { ethers } from 'ethers'
import { BountyEscrowABI } from '@lucci/contracts'

// Connect to contract
const provider = new ethers.providers.JsonRpcProvider(RPC_URL)
const signer = provider.getSigner()

const bountyEscrow = new ethers.Contract(
  BOUNTY_ESCROW_ADDRESS,
  BountyEscrowABI,
  signer
)

// Create a bounty
async function createBounty(payee: string, amount: bigint) {
  const tx = await bountyEscrow.createBounty(payee, amount, {
    value: amount,
    gasLimit: 200000
  })
  
  const receipt = await tx.wait()
  
  // Get bounty ID from event
  const event = receipt.events?.find(e => e.event === 'BountyCreated')
  const bountyId = event?.args?.bountyId
  
  return bountyId
}

// Listen for events
bountyEscrow.on('BountyPaid', (bountyId, payee, amount) => {
  console.log(`Bounty ${bountyId} paid to ${payee}`)
  console.log(`Amount: ${ethers.utils.formatEther(amount)} ETH`)
})
```

### Using with Wagmi/Viem

```typescript
import { useWriteContract, useReadContract } from 'wagmi'
import { parseEther } from 'viem'

function BountyCreator() {
  const { writeContract } = useWriteContract()
  
  const createBounty = async () => {
    await writeContract({
      address: BOUNTY_ESCROW_ADDRESS,
      abi: BountyEscrowABI,
      functionName: 'createBounty',
      args: [payeeAddress, parseEther('1')],
      value: parseEther('1')
    })
  }
  
  return <button onClick={createBounty}>Create Bounty</button>
}

function BountyStatus({ bountyId }: { bountyId: bigint }) {
  const { data: bounty } = useReadContract({
    address: BOUNTY_ESCROW_ADDRESS,
    abi: BountyEscrowABI,
    functionName: 'getBounty',
    args: [bountyId]
  })
  
  return <div>Status: {bounty?.status}</div>
}
```

## Error Handling

### Common Errors

```typescript
import { BountyPayError, ErrorCode } from '@lucci/bountypay'

try {
  await bountyPay.createBounty({ /* ... */ })
} catch (error) {
  if (error instanceof BountyPayError) {
    switch (error.code) {
      case ErrorCode.INSUFFICIENT_FUNDS:
        console.error('Not enough USDC in account')
        break
      case ErrorCode.INVALID_ISSUE:
        console.error('Issue not found or already has bounty')
        break
      case ErrorCode.NETWORK_ERROR:
        console.error('Network connection issue')
        break
      default:
        console.error('Unknown error:', error.message)
    }
  }
}
```

### Retry Logic

```typescript
async function withRetry<T>(
  fn: () => Promise<T>,
  maxRetries = 3,
  delay = 1000
): Promise<T> {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn()
    } catch (error) {
      if (i === maxRetries - 1) throw error
      
      console.log(`Attempt ${i + 1} failed, retrying in ${delay}ms...`)
      await new Promise(resolve => setTimeout(resolve, delay))
      delay *= 2 // Exponential backoff
    }
  }
  
  throw new Error('Max retries exceeded')
}

// Usage
const bounty = await withRetry(() =>
  bountyPay.createBounty({ /* ... */ })
)
```

## Testing

### Unit Tests

```typescript
import { BountyPayClient } from '@lucci/bountypay'
import { MockProvider } from '@lucci/testing'

describe('BountyPay Integration', () => {
  let client: BountyPayClient
  let mockProvider: MockProvider
  
  beforeEach(() => {
    mockProvider = new MockProvider()
    client = new BountyPayClient({
      provider: mockProvider,
      apiKey: 'test_key'
    })
  })
  
  it('should create a bounty', async () => {
    mockProvider.mockResponse({
      id: 'bty_123',
      status: 'open',
      amount: '100.00'
    })
    
    const bounty = await client.createBounty({
      repository: 'test/repo',
      issueNumber: 1,
      amount: 100
    })
    
    expect(bounty.id).toBe('bty_123')
    expect(bounty.status).toBe('open')
  })
})
```

### Integration Tests

```typescript
import { createTestClient } from 'viem/test'
import { foundry } from 'viem/chains'

describe('Smart Contract Integration', () => {
  it('should create and pay bounty', async () => {
    const testClient = createTestClient({
      mode: 'anvil',
      chain: foundry
    })
    
    // Deploy contract
    const contract = await deployBountyEscrow(testClient)
    
    // Create bounty
    const bountyId = await contract.write.createBounty([
      payeeAddress,
      parseEther('1')
    ], {
      value: parseEther('1')
    })
    
    // Verify bounty created
    const bounty = await contract.read.getBounty([bountyId])
    expect(bounty.status).toBe(BountyStatus.Open)
    
    // Pay bounty
    await contract.write.releaseBounty([bountyId])
    
    // Verify payment
    const updatedBounty = await contract.read.getBounty([bountyId])
    expect(updatedBounty.status).toBe(BountyStatus.Paid)
  })
})
```

## Performance Optimization

### Caching Strategies

```typescript
import { LRUCache } from 'lru-cache'

const cache = new LRUCache({
  max: 500,
  ttl: 1000 * 60 * 5 // 5 minutes
})

async function getCachedBounty(bountyId: string) {
  // Check cache first
  const cached = cache.get(bountyId)
  if (cached) return cached
  
  // Fetch from API
  const bounty = await bountyPay.getBounty(bountyId)
  
  // Store in cache
  cache.set(bountyId, bounty)
  
  return bounty
}
```

### Batch Requests

```typescript
// Instead of multiple individual requests
for (const id of bountyIds) {
  const bounty = await bountyPay.getBounty(id) // Slow!
}

// Batch them
const bounties = await bountyPay.getBounties(bountyIds) // Fast!
```

## Monitoring and Logging

### Application Logging

```typescript
import { logger } from '@lucci/logger'

// Configure logger
logger.configure({
  level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',
  service: 'your-app-name'
})

// Use throughout your app
logger.info('Creating bounty', { repository, issueNumber, amount })

try {
  const bounty = await bountyPay.createBounty({ /* ... */ })
  logger.info('Bounty created successfully', { bountyId: bounty.id })
} catch (error) {
  logger.error('Failed to create bounty', { error, repository, issueNumber })
}
```

### Metrics Collection

```typescript
import { metrics } from '@lucci/metrics'

// Track bounty creations
metrics.increment('bounties.created')

// Track bounty amounts
metrics.histogram('bounty.amount', amount)

// Track API latency
const start = Date.now()
await bountyPay.createBounty({ /* ... */ })
metrics.timing('api.createBounty', Date.now() - start)
```

## Production Checklist

Before deploying to production:

- [ ] API keys stored securely in environment variables
- [ ] Error handling implemented for all API calls
- [ ] Retry logic for transient failures
- [ ] Logging configured for debugging
- [ ] Rate limiting implemented
- [ ] Caching strategy in place
- [ ] Tests passing (unit and integration)
- [ ] Monitoring and alerts set up
- [ ] Documentation updated
- [ ] Security review completed

## Next Steps

- [Security Best Practices](/docs/guides/security)
- [Architecture Overview](/docs/architecture)
- [Product Documentation](/docs/products/bountypay)

## Support

Need help with integration?

- [GitHub Discussions](https://github.com/lucci-xyz/bounty/discussions)
- [Discord Community](https://discord.gg/lucci)
- [Email Support](mailto:support@lucci.xyz)
